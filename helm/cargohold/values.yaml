# ============================================================================
# Helm Chart Metadata
# ============================================================================
nameOverride: ""
fullnameOverride: ""

# ============================================================================
# Workload (Deployment) Configuration
# ============================================================================
deployment:
  # Set to 0 when an external controller (e.g., Argo Rollouts) manages replicas
  replicaCount: 2

  image:
    repository: cargohold
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion
    tag: ""

  imagePullSecrets: []

  # Pod configuration
  pod:
    annotations: {}
    labels: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # Container configuration
  container:
    resources: {}
    livenessProbe:
      httpGet:
        path: /healthz
        port: http
      initialDelaySeconds: 5
      periodSeconds: 10
    readinessProbe:
      httpGet:
        path: /readyz
        port: http
      initialDelaySeconds: 5
      periodSeconds: 10

# ============================================================================
# Networking Configuration
# ============================================================================
service:
  type: ClusterIP
  port: 80
  targetPort: 8080
  annotations: {}

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# ============================================================================
# Identity & Access Configuration
# ============================================================================
serviceAccount:
  create: true
  annotations: {}
  name: ""

# ============================================================================
# Scaling & Availability Configuration
# ============================================================================
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
  # Change apiVersion/kind when using an external controller
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment

podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

# ============================================================================
# Application Configuration
# ============================================================================
cargohold:
  server:
    trustProxy: false
    trustedProxyCIDRs: []
    # Proxyエンドポイントのタイムアウト設定
    # 大きなファイルの転送に対応するため、デフォルトは10分
    proxyTimeout: "10m"

  oidc:
    github:
      enabled: true
      audience: "cargohold"
      jwksUrl: "https://token.actions.githubusercontent.com/.well-known/jwks"

# ============================================================================
# Database Migration Configuration
# ============================================================================
migration:
  # Enable database migration job (runs as Helm pre-install/pre-upgrade hook)
  enabled: true
  # Migration image configuration (separate from application image)
  image:
    repository: cargohold-migration
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion
    tag: ""
  # Migration command arguments (up, down, status, version)
  args: ["up"]
  # Number of retries if migration fails
  backoffLimit: 3
  # Pod annotations for migration job
  podAnnotations: {}
  # Additional environment variables for migration job
  extraEnv: []
  # Resource limits/requests for migration job
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# ============================================================================
# External Dependencies Configuration
# ============================================================================

# PostgreSQL component
postgres:
  host: "postgres"
  port: 5432
  user: "cargohold"
  database: "cargohold"
  sslMode: "require"
  # Password for PostgreSQL authentication
  password: ""
  # Name of existing secret to use (takes precedence over password)
  existingSecret: ""
  # Key in the existing secret that contains the password
  existingSecretKey: "password"

# Redis component
redis:
  host: "redis"
  port: 6379
  db: 0
  # Password for Redis authentication
  password: ""
  # Name of existing secret to use (takes precedence over password)
  existingSecret: ""
  # Key in the existing secret that contains the password
  existingSecretKey: "password"

# S3 component
s3:
  endpoint: ""
  bucketName: "lfs-objects"
  region: "us-east-1"
  credentials:
    # AWS access key ID
    accessKeyId: ""
    # AWS secret access key
    secretAccessKey: ""
  # Name of existing secret to use (takes precedence over credentials)
  existingSecret: ""
  # Keys in the existing secret that contain credentials
  existingSecretKeys:
    accessKeyId: "access-key-id"
    secretAccessKey: "secret-access-key"

# ============================================================================
# Advanced Customization
# ============================================================================
extraEnv: []
extraVolumes: []
extraVolumeMounts: []
extraContainers: []
extraObjects: []
