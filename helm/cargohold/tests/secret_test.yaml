suite: Secret tests
templates:
  - templates/secret.yaml
tests:
  - it: creates Secret with default values
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: type
          value: Opaque

  - it: includes required keys
    asserts:
      - exists:
          path: data["database-password"]
      - exists:
          path: data["redis-password"]
      - exists:
          path: data["s3-access-key-id"]
      - exists:
          path: data["s3-secret-access-key"]

  - it: does not create Secret when all components use existingSecret
    set:
      postgres:
        existingSecret: postgres-secret
      redis:
        existingSecret: redis-secret
      s3:
        existingSecret: s3-secret
    asserts:
      - hasDocuments:
          count: 0

  - it: creates Secret with only non-existingSecret components
    set:
      postgres:
        password: "test-password"
      redis:
        existingSecret: redis-secret
      s3:
        existingSecret: s3-secret
    asserts:
      - isKind:
          of: Secret
      - exists:
          path: data["database-password"]
      - notExists:
          path: data["redis-password"]
      - notExists:
          path: data["s3-access-key-id"]

  - it: Base64 encodes passwords
    set:
      postgres:
        password: "test-password"
    asserts:
      - equal:
          path: data["database-password"]
          value: "dGVzdC1wYXNzd29yZA=="
