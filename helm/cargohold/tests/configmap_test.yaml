suite: ConfigMap tests
templates:
  - templates/configmap.yaml
tests:
  - it: creates ConfigMap with default values
    asserts:
      - isKind:
          of: ConfigMap
      - isNotEmpty:
          path: data["config.yaml"]

  - it: includes database configuration
    asserts:
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'database:'
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'host: "postgres"'

  - it: includes Redis configuration
    asserts:
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'redis:'
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'port: 6379'

  - it: includes S3 configuration
    asserts:
      - matchRegex:
          path: data["config.yaml"]
          pattern: 's3:'
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'bucketName: "lfs-objects"'

  - it: includes OIDC configuration
    asserts:
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'oidc:'
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'github:'
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'enabled: true'

  - it: allows custom configuration
    set:
      postgres:
        host: "custom-postgres"
        port: 5433
      redis:
        host: "custom-redis"
    asserts:
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'host: "custom-postgres"'
      - matchRegex:
          path: data["config.yaml"]
          pattern: 'host: "custom-redis"'
