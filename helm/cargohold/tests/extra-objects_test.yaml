suite: ExtraObjects tests
templates:
  - templates/extra-objects.yaml
tests:
  - it: does not create anything by default
    asserts:
      - hasDocuments:
          count: 0

  - it: creates custom resources with extraObjects
    set:
      extraObjects:
        - apiVersion: v1
          kind: ConfigMap
          metadata:
            name: extra-config
          data:
            key: value
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: extra-config

  - it: allows multiple extraObjects
    set:
      extraObjects:
        - apiVersion: v1
          kind: ConfigMap
          metadata:
            name: config-1
          data:
            key: value1
        - apiVersion: v1
          kind: Secret
          metadata:
            name: secret-1
          type: Opaque
          data:
            key: dmFsdWU=
    asserts:
      - hasDocuments:
          count: 2

  - it: expands template variables
    set:
      extraObjects:
        - apiVersion: v1
          kind: ConfigMap
          metadata:
            name: '{{ include "cargohold.fullname" . }}-extra'
          data:
            key: value
    asserts:
      - equal:
          path: metadata.name
          value: RELEASE-NAME-cargohold-extra
